<!--
  S3-HKD: SỔ CHI PHÍ SẢN XUẤT, KINH DOANH
  Circular 88/2021/TT-BTC - Appendix 2 - Mẫu số S3-HKD
-->
<div class="ledger-page">
  <!-- Page Title -->
  <h2 class="page-title">SỔ CHI PHÍ SẢN XUẤT, KINH DOANH</h2>

  <!-- Entry Form -->
  <div class="entry-form">
    <div class="form-title">Thêm bút toán chi phí mới</div>
    
    <!-- Basic info -->
    <div class="form-section">
      <div class="form-grid form-grid-basic">
        <div class="form-group">
          <label>Ngày ghi sổ *</label>
          <input type="date" [(ngModel)]="newRecord.ngayThangGhiSo" />
        </div>
        <div class="form-group">
          <label>Số hiệu CT *</label>
          <input type="text" [(ngModel)]="newRecord.chungTu!.soHieu" placeholder="VD: CP001" />
        </div>
        <div class="form-group">
          <label>Ngày CT</label>
          <input type="date" [(ngModel)]="newRecord.chungTu!.ngayThang" />
        </div>
        <div class="form-group form-group-wide">
          <label>Diễn giải *</label>
          <input type="text" [(ngModel)]="newRecord.dienGiai" placeholder="Nội dung chi phí" />
        </div>
      </div>
    </div>

    <!-- Cost breakdown -->
    <div class="form-section">
      <div class="section-title">Phân loại chi phí</div>
      <div class="form-grid form-grid-costs">
        <div class="form-group">
          <label>Vật liệu, dụng cụ, HH</label>
          <input type="number" [(ngModel)]="newRecord.tienVatLieu" placeholder="0" />
        </div>
        <div class="form-group">
          <label>Nhân công</label>
          <input type="number" [(ngModel)]="newRecord.tienNhanCong" placeholder="0" />
        </div>
        <div class="form-group">
          <label>Khấu hao TSCĐ</label>
          <input type="number" [(ngModel)]="newRecord.chiPhiKhauHao" placeholder="0" />
        </div>
        <div class="form-group">
          <label>Thuê mặt bằng</label>
          <input type="number" [(ngModel)]="newRecord.chiPhiThueMatBang" placeholder="0" />
        </div>
        <div class="form-group">
          <label>Điện, nước, NL</label>
          <input type="number" [(ngModel)]="newRecord.chiPhiDienNuoc" placeholder="0" />
        </div>
        <div class="form-group">
          <label>Vận chuyển</label>
          <input type="number" [(ngModel)]="newRecord.chiPhiVanChuyen" placeholder="0" />
        </div>
        <div class="form-group">
          <label>Mua ngoài khác</label>
          <input type="number" [(ngModel)]="newRecord.chiPhiMuaNgoaiKhac" placeholder="0" />
        </div>
        <div class="form-group form-total">
          <label>TỔNG CỘNG</label>
          <div class="total-value">{{ calculateFormTotal() | number:'1.0-0' }}</div>
        </div>
      </div>
    </div>

    <div class="form-actions">
      <button class="btn-add" (click)="addRecord()">+ Thêm bút toán</button>
    </div>
  </div>

  <!-- Summary -->
  <div class="summary-bar">
    <span>Tổng số bút toán: <strong>{{ data.length }}</strong></span>
    <span>Tổng chi phí: <strong>{{ getTongChiPhi() }}</strong></span>
  </div>

  <!-- Data Table -->
  <app-ledger-table
    [headerRows]="headerRows"
    [columnLabels]="columnLabels"
    [dataColumns]="dataColumns"
    [data]="data"
    [footerRows]="footerRows"
    [showStt]="false"
    [editable]="true"
    (rowSaved)="updateRecord($event)"
    (rowDeleted)="deleteRecord($event)">
  </app-ledger-table>
</div>
